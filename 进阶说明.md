

# 进阶说明

本文档用于详细介绍桔梦使用。 施工中，此处可能含有过时内容。

## 配置文件

【待补充】

1. 配置Jiemeng相关配置[config.json]
	- (可参考预设文件)

    | 字段          | 类型     | 说明                                        | 默认值                   |
    | ------------- | -------- | ------------------------------------------- | ------------------------ |
    | self_id       | string   | bot qq号                                    | 0                        |
    | port          | int      | WebSocket端口                               | 必填                     |
    | Debug_Mode    | bool     | 是否启用Debug日志信息显示                   | false                    |
    | private_black | bool     | 私聊名单(private_list)是否作为黑名单        | true                     |
    | admin_list    | object   | 管理员列表<br/>"QQ号(string)":管理等级(int) | 无默认，需保证类型正确   |
    | private_list  | string[] | 私聊名单                                    | 无默认，需保证类型是数组 |
    | black_list    | string[] | 全局黑名单                                  | 无默认，需保证类型是数组 |
    | group_list    | string[] | 群聊白名单                                  | 无默认，需保证类型是数组 |
		- `Custom_Config`
  		- 任意自定义量。
  		- 词库中所有形如 `{~...}` 的字符串会被替换为其对应的 `Custom_Config` 中设定的值。
  		- 例如你在 `Custom_Config` 中设定了 `"test": "1234"` ，那么你词库中所有的 `{~test}` 都会被替换为 `1234`



## 应答库文件

### 应答组

应答库由若干个应答组组成。

- 所有的应答组对象将作为一个对象数组保存在"Answers"字段中。

### 应答组对象

| 字段  | 类型            | 描述                   |
| ----- | --------------- | ---------------------- |
| regex | string or array | 匹配规则。             |
| anss  | array           | 应答                   |
| level | int             | 生效等级，用于权限控制 |
| grps  | string[]        |                        |
| user  | string[]        |                        |
| pri   | int             | 指定应答组的优先级     |

### regex 字段


从实例入手来看：

#### 实例 1

```
"regex": "早"
```

| 消息内容   | 匹配结果 |
| ---------- | -------- |
| 早         | true     |
| 早上好     | true     |
| 你走的真早 | true     |
| 晚上好     | false    |

#### 实例 2

```
"regex": ["早", {"not": "真早"}]
```

| 消息内容   | 匹配结果 | 说明                                             |
| ---------- | -------- | ------------------------------------------------ |
| 早         | true     | 逻辑或，两个子判断均为true（含有早，不含有真早） |
| 早上好     | true     | 两个子判断均为true                               |
| 你走的真早 | true     | true, false, 逻辑或结果为true                    |
| 晚上好     | true     | false, true, 逻辑或结果为true                    |


### anss 字段

### 应答元素
说明


### 逻辑

- 所有应答组按优先级由大至小排序。
- 收到消息后按顺序检查是否匹配应答组条件。
- 触发应答组后，执行对应的应答元素操作
- 匹配到后，不继续进行后续匹配，除非执行的应答操作中执行了 ignore 指令

## 指令


## 事件消息


| 消息内容 | 含义                                                                                                                |
| -------- | ------------------------------------------------------------------------------------------------------------------- |
| [HH:MM]  | 表示当前时间。由Jiemeng本体产生，默认每30s检查一次当前时间，若与上次检查结果不同则会发送该消息，例如[07:05],[23:59] |
| CQ code  | 参考 Onebot 标准。例如[CQ:image,file=...]                                                                           |



## r点表达式

一个合法的r点表达式为一个仅有数字与【+-*^d()】这些运算的表达式。
##### ()
括号内内容优先计算。
##### d
- 可作单目运算符，也可作双目运算符。
- 表达式 $ndm$ 值等于投掷n个m面骰子(1~m)的结果。
- 注：当n>2^23时，$ndm$将恒为0.
##### +-*^
分别为 加 减 乘 乘方
##### 优先级

表达式中的各项运算满足以下优先级顺序。

【()】>【d】>【^】>【*】>【+ or -】

##### 注意事项

参与计算的数字仅允许为正整数，请避免任何非结果步骤中出现负数。

---
